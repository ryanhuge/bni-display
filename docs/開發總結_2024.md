# BNI 會議數據展示系統 - 開發總結

## 開發日期
2024 年

---

## 一、PDF 解析優化

### 問題描述
PALMS 週報 PDF 解析時，部分會員名字被截斷或無法正確解析，特別是：
- 第一位會員「洪偵哲」被漏掉
- 有括號別名的會員如「劉祐辰(劉兆恩)」、「楊忠維(阿MO)」解析異常

### 解決方案
重寫 `/src/lib/pdf-parser.ts` 的解析邏輯：

1. **新策略**：先找數字序列，再往回截取名字
2. **核心正則**：
   ```typescript
   // 匹配 13 個數字欄位的數據序列
   const dataPattern = /(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+([\d,.]+)\s+(\d+)/g;

   // 從數字序列前方提取姓名（要求姓氏前有數字或2+空格作為分隔）
   const nameMatch = prefix.match(/(?:\d\s*|\s{2,})([\u4e00-\u9fff])\s{2,}([\u4e00-\u9fffa-zA-Z()（）\s]{1,20}?)\s*$/);
   ```

3. **去重機制**：使用 `Set` 避免重複解析同一會員

### 結果
成功解析全部 30 位會員資料

---

## 二、首頁統計概覽重構

### 需求
將首頁改為表格數據組成的統計概覽

### 實作內容
修改 `/src/pages/Home.tsx`：

1. **總覽統計表格**
   - 會員總數、出席率
   - 總引薦數、一對一會面
   - 來賓人次、教育學分
   - 交易總額

2. **紅綠燈分佈表格**
   - 燈號（綠/黃/紅/灰）
   - 人數、佔比

3. **Top 5 排行榜**（四欄並排）
   - 引薦 Top 5
   - 一對一 Top 5
   - 來賓 Top 5
   - 交易額 Top 5

4. **快捷連結**
   - 展示頁面：週報展示、紅綠燈榮耀榜、抽獎
   - 後台管理：上傳週報、上傳半年報

### UI 改進
- 使用 shadcn/ui Table 元件（`Table`, `TableRow`, `TableCell`, `TableHead`, `TableHeader`, `TableBody`）
- 移除圓角，使用方形邊框
- 適當的內間距，文字不貼邊

---

## 三、抽獎頁面整理與功能新增

### UI 整理
修改 `/src/pages/Lottery.tsx`：

1. **統計區改為表格形式**
   - 候選人數、總抽獎次數、已抽出

2. **移除圓角**
   - 頂部標題區、幸運大轉盤、控制區、候選人名單

3. **使用 shadcn/ui Table 元件**
   - 候選人名單表格
   - 本場次中獎記錄表格

### 新增功能：多人抽獎
允許設定本次要抽出的得獎者人數

#### 新增狀態
```typescript
const [winnersCount, setWinnersCount] = useState(1); // 本次要抽出的人數，預設 1 位
const [currentDrawIndex, setCurrentDrawIndex] = useState(0); // 目前抽到第幾位
const [currentWinners, setCurrentWinners] = useState<string[]>([]); // 本輪抽出的所有得獎者
```

#### 功能說明
1. **人數設定**
   - 預設 1 位
   - 可用 +/- 按鈕增減
   - 最少 1 位，最多為候選人總數
   - 抽獎進行中或已開始抽獎時，按鈕禁用

2. **抽獎流程**
   - 開始抽獎 → 停止抽獎 → 顯示得獎者
   - 若設定多位：顯示「繼續抽獎 (1/3)」按鈕
   - 抽完後：顯示「✓ 完成本輪」按鈕

3. **進度顯示**
   - 控制區顯示「進度：1 / 3（還剩 2 位）」
   - 中獎區顯示「🎉 恭喜中獎 (第 1 位) 🎉」
   - 多人時顯示本輪所有得獎者列表

#### 新增函數
```typescript
// 繼續抽下一位
const handleContinueDraw = () => {...};

// 完成本輪抽獎
const handleFinishRound = () => {...};

// 增減抽獎人數
const incrementWinnersCount = () => {...};
const decrementWinnersCount = () => {...};
```

---

## 四、技術要點

### 使用的元件庫
- **shadcn/ui**：Table, Button, Card 等元件
- **Lucide React**：圖示（Gift, Trophy, Plus, Minus 等）
- **Zustand**：狀態管理（weeklyStore, trafficLightStore, lotteryStore）

### BNI 官方配色
```typescript
const BNI_RED = '#C8102E';   // 主色紅
const BNI_GRAY = '#4A4A4A';  // 灰色
const BNI_GOLD = '#B8860B';  // 金色（用於中獎、排名）
```

### 檔案修改清單
| 檔案路徑 | 修改內容 |
|---------|---------|
| `/src/lib/pdf-parser.ts` | PDF 解析邏輯重寫 |
| `/src/pages/Home.tsx` | 首頁統計概覽重構 |
| `/src/pages/Lottery.tsx` | UI 整理 + 多人抽獎功能 |

---

## 五、待優化項目

1. **效能優化**
   - Build 警告：chunk 超過 500KB，可考慮 code-splitting

2. **功能擴充**
   - 抽獎音效檔案需放置於 `/public/sounds/` 目錄
   - 可考慮新增抽獎歷史記錄匯出功能

3. **UI/UX**
   - 響應式設計優化（手機版）
   - 深色模式支援

---

## 六、測試確認

- [x] PDF 解析：30 位會員全部正確解析
- [x] 首頁統計：表格正確顯示，資料計算正確
- [x] 抽獎功能：單人/多人抽獎流程正常
- [x] UI 風格：統一使用方形邊框，表格內間距適當
